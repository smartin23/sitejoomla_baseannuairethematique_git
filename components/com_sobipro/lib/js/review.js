jQuery(function(){var a=jQuery("#sprrMsgIn").html();jQuery.fn.SprrScrollTo=function(){jQuery(this).show();jQuery("html, body").animate({scrollTop:jQuery(this).offset().top-15+"px"},"fast");return this};jQuery("input.sprrstar").rating({half:true});jQuery("#spRrShowForm").bind("click",function(){jQuery("#spReviewCont").show("clip");jQuery("#spRrShowForm").hide()});jQuery("#spRrHideForm").bind("click",function(){jQuery("#spReviewCont").hide("clip");jQuery("#spRrShowForm").show()});jQuery(".sprrRevReport").button();jQuery(".sprrRevReport").bind("click",function(){jQuery("#reviewReportRid").val(this.name);var b={};var c=jQuery("#sprrRevReportFormBt").html();b[c]=function(){modal=this;jQuery.ajax({url:SobiProUrl.replace("%task%","review.report")+"&format=raw&sid="+SobiProSection,data:jQuery("#sprrRevReportForm form").serialize(),type:"POST",dataType:"json",success:function(b){if(b.status=="error"){alert(b.message)}else{jQuery("#sprrMsgIn").html(a+b.message);if(b.status=="failed"){jQuery("#sprrMsg div").attr("class","ui-state-error ui-corner-all");jQuery("#sprrMsgIn span").removeClass("ui-icon-info").addClass("ui-icon-alert")}else{jQuery("#sprrMsg div").attr("class","ui-state-highlight ui-corner-all")}jQuery(modal).dialog("close");jQuery("#sprrRevReportForm").dialog("destroy");jQuery("#sprrMsg").show("highlight");jQuery("#sprrMsg").SprrScrollTo()}}})};jQuery(":input","#sprrRevReportForm form").not(":button, :submit, :reset, :hidden").val("").removeAttr("checked").removeAttr("selected");jQuery("#sprrRevReportForm").dialog({minHeight:400,width:450,modal:true,show:"slide",hide:"slide",buttons:b})});jQuery("#spRrSubmit").bind("click",function(){jQuery("#sprr").fadeTo("slow",.1);jQuery.ajax({url:SobiProUrl.replace("%task%","review.submit")+"&format=raw&sid="+SobiProSection,data:jQuery("#sprr").serialize(),type:"POST",dataType:"json",success:function(b){if(b.status=="ok"){jQuery("#sprrMsg div").attr("class","ui-state-highlight ui-corner-all");jQuery("#sprrMsgIn").html(a+b.response);jQuery("#sprrMsg").show("highlight");jQuery("#sprr").hide("clip");jQuery("#spSendBt").hide("clip");jQuery("#sprrMsg").SprrScrollTo()}else{alert(b.response);jQuery("#sprr").fadeTo("fast",1)}},error:function(a){jQuery("#sprr").fadeTo("fast",1)}})})});(function(a){var b=new Array;var c=new Array;a.fn.addTag=function(d,e){var e=jQuery.extend({focus:false,callback:true},e);this.each(function(){id=a(this).attr("id");var f=a(this).val().split(b[id]);if(f[0]==""){f=new Array}d=jQuery.trim(d);if(e.unique){skipTag=a(f).tagExist(d)}else{skipTag=false}if(d!=""&&skipTag!=true){a("<span>").addClass("tag").append(a("<span>").text(d).append("  "),a("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return a("#"+id).removeTag(escape(d))})).insertBefore("#"+id+"_addTag");f.push(d);a("#"+id+"_tag").val("");if(e.focus){a("#"+id+"_tag").focus()}else{a("#"+id+"_tag").blur()}if(e.callback&&c[id]&&c[id]["onAddTag"]){var g=c[id]["onAddTag"];g(d)}if(c[id]&&c[id]["onChange"]){var h=f.length;var g=c[id]["onChange"];g(a(this),f[h])}}a.fn.tagsInput.updateTagsField(this,f)});return false};a.fn.removeTag=function(d){d=unescape(d);this.each(function(){id=a(this).attr("id");var e=a(this).val().split(b[id]);a("#"+id+"_tagsinput .tag").remove();str="";for(i=0;i<e.length;i++){if(e[i]!=d){str=str+b[id]+e[i]}}a.fn.tagsInput.importTags(this,str);if(c[id]&&c[id]["onRemoveTag"]){var f=c[id]["onRemoveTag"];f(d)}});return false};a.fn.tagExist=function(b){if(jQuery.inArray(b,a(this))==-1){return false}else{return true}};a.fn.importTags=function(b){a("#"+id+"_tagsinput .tag").remove();a.fn.tagsInput.importTags(this,b)};a.fn.tagsInput=function(d){var e=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",hide:true,delimiter:",",autocomplete:{selectFirst:false},unique:true,removeWithBackspace:true},d);this.each(function(){if(e.hide){a(this).hide()}id=a(this).attr("id");data=jQuery.extend({pid:id,real_input:"#"+id,holder:"#"+id+"_tagsinput",input_wrapper:"#"+id+"_addTag",fake_input:"#"+id+"_tag"},e);b[id]=data.delimiter;if(e.onAddTag||e.onRemoveTag||e.onChange){c[id]=new Array;c[id]["onAddTag"]=e.onAddTag;c[id]["onRemoveTag"]=e.onRemoveTag;c[id]["onChange"]=e.onChange}var d='<div id="'+id+'_tagsinput" class="tagsinput"><div id="'+id+'_addTag">';if(e.interactive){d=d+'<input id="'+id+'_tag" value="" data-default="'+e.defaultText+'" />'}d=d+'</div><div class="tags_clear"></div></div>';a(d).insertAfter(this);a(data.holder).css("width",e.width);a(data.holder).css("height",e.height);if(a(data.real_input).val()!=""){a.fn.tagsInput.importTags(a(data.real_input),a(data.real_input).val())}if(e.interactive){a(data.fake_input).val(a(data.fake_input).attr("data-default"));a(data.fake_input).css("color","#666666");a(data.holder).bind("click",data,function(b){a(b.data.fake_input).focus()});a(data.fake_input).bind("focus",data,function(b){if(a(b.data.fake_input).val()==a(b.data.fake_input).attr("data-default")){a(b.data.fake_input).val("")}a(b.data.fake_input).css("color","#000000")});if(e.autocomplete_url!=undefined){a(data.fake_input).autocomplete(e.autocomplete_url,e.autocomplete).bind("result",data,function(b,c,d){if(c){a(b.data.real_input).addTag(d,{focus:true,unique:e.unique})}});a(data.fake_input).bind("blur",data,function(b){if(a(".ac_results").is(":visible")){return false}if(a(b.data.fake_input).val()!=a(b.data.fake_input).attr("data-default")){if(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)){a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:false,unique:e.unique})}}a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default"));a(b.data.fake_input).css("color","#666666");return false})}else{a(data.fake_input).bind("blur",data,function(b){var c=a(this).attr("data-default");if(a(b.data.fake_input).val()!=""&&a(b.data.fake_input).val()!=c){if(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)){a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:true,unique:e.unique})}}else{a(b.data.fake_input).val(a(b.data.fake_input).attr("data-default"));a(b.data.fake_input).css("color","#666666")}return false})}a(data.fake_input).bind("keypress",data,function(b){if(b.which==b.data.delimiter.charCodeAt(0)||b.which==13){if(b.data.minChars<=a(b.data.fake_input).val().length&&(!b.data.maxChars||b.data.maxChars>=a(b.data.fake_input).val().length)){a(b.data.real_input).addTag(a(b.data.fake_input).val(),{focus:true,unique:e.unique})}return false}});data.removeWithBackspace&&a(data.fake_input).bind("keyup",function(b){if(b.keyCode==8&&a(this).val()==""){var c=a(this).closest(".tagsinput").find(".tag:last").text();var d=a(this).attr("id").replace(/_tag$/,"");c=c.replace(/[\s]+x$/,"");a("#"+d).removeTag(escape(c));a(this).trigger("focus")}});a(data.fake_input).blur()}return false});return this};a.fn.tagsInput.updateTagsField=function(c,d){id=a(c).attr("id");a(c).val(d.join(b[id]))};a.fn.tagsInput.importTags=function(d,e){a(d).val("");id=a(d).attr("id");var f=e.split(b[id]);for(i=0;i<f.length;i++){a(d).addTag(f[i],{focus:false,callback:false})}if(c[id]&&c[id]["onChange"]){var g=c[id]["onChange"];g(d,f[i])}}})(jQuery)
